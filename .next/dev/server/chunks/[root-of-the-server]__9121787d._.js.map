{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/chelseygowac/book-tracker-app/src/lib/supabase/client.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport const getUser = async () => {\n  const { data: { user } } = await supabase.auth.getUser();\n  return user;\n};"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,0NAAY,EAAC,aAAa;AAE3C,MAAM,UAAU;IACrB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,OAAO;AACT"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///Users/chelseygowac/book-tracker-app/src/lib/data-sources/book-sources.ts"],"sourcesContent":["import axios from 'axios';\n\nexport async function searchBooksOpenLibrary(query: string, limit = 20) {\n  try {\n    const response = await axios.get(`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=${limit}`);\n    return response.data.docs.map((book: any) => ({\n      title: book.title,\n      author: book.author_name?.[0] || 'Unknown Author',\n      isbn: book.isbn?.[0],\n      coverUrl: book.cover_i ? `https://covers.openlibrary.org/b/id/${book.cover_i}-M.jpg` : null,\n      publishedDate: book.first_publish_year,\n      pageCount: book.number_of_pages_median,\n      description: null, // Open Library doesn't typically provide descriptions\n    }));\n  } catch (error) {\n    console.error('Open Library search error:', error);\n    return [];\n  }\n}\n\nexport async function searchBooksGoogleAI(query: string, limit = 20) {\n  try {\n    const response = await axios.get(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=${limit}`);\n    return response.data.items.map((book: any) => ({\n      title: book.volumeInfo.title,\n      author: book.volumeInfo.authors?.[0] || 'Unknown Author',\n      isbn: book.volumeInfo.industryIdentifiers?.find((id: any) => id.type === 'ISBN_13')?.identifier,\n      coverUrl: book.volumeInfo.imageLinks?.thumbnail,\n      publishedDate: book.volumeInfo.publishedDate,\n      pageCount: book.volumeInfo.pageCount,\n      description: book.volumeInfo.description,\n    }));\n  } catch (error) {\n    console.error('Google Books search error:', error);\n    return [];\n  }\n}\n\nexport async function searchBooks(query: string, limit = 20) {\n  const openLibraryResults = await searchBooksOpenLibrary(query, limit);\n  \n  if (openLibraryResults.length > 0) {\n    return openLibraryResults;\n  }\n  \n  return searchBooksGoogleAI(query, limit);\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,eAAe,uBAAuB,KAAa,EAAE,QAAQ,EAAE;IACpE,IAAI;QACF,MAAM,WAAW,MAAM,4KAAK,CAAC,GAAG,CAAC,CAAC,sCAAsC,EAAE,mBAAmB,OAAO,OAAO,EAAE,OAAO;QACpH,OAAO,SAAS,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAc,CAAC;gBAC5C,OAAO,KAAK,KAAK;gBACjB,QAAQ,KAAK,WAAW,EAAE,CAAC,EAAE,IAAI;gBACjC,MAAM,KAAK,IAAI,EAAE,CAAC,EAAE;gBACpB,UAAU,KAAK,OAAO,GAAG,CAAC,oCAAoC,EAAE,KAAK,OAAO,CAAC,MAAM,CAAC,GAAG;gBACvF,eAAe,KAAK,kBAAkB;gBACtC,WAAW,KAAK,sBAAsB;gBACtC,aAAa;YACf,CAAC;IACH,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,EAAE;IACX;AACF;AAEO,eAAe,oBAAoB,KAAa,EAAE,QAAQ,EAAE;IACjE,IAAI;QACF,MAAM,WAAW,MAAM,4KAAK,CAAC,GAAG,CAAC,CAAC,8CAA8C,EAAE,mBAAmB,OAAO,YAAY,EAAE,OAAO;QACjI,OAAO,SAAS,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,OAAc,CAAC;gBAC7C,OAAO,KAAK,UAAU,CAAC,KAAK;gBAC5B,QAAQ,KAAK,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE,IAAI;gBACxC,MAAM,KAAK,UAAU,CAAC,mBAAmB,EAAE,KAAK,CAAC,KAAY,GAAG,IAAI,KAAK,YAAY;gBACrF,UAAU,KAAK,UAAU,CAAC,UAAU,EAAE;gBACtC,eAAe,KAAK,UAAU,CAAC,aAAa;gBAC5C,WAAW,KAAK,UAAU,CAAC,SAAS;gBACpC,aAAa,KAAK,UAAU,CAAC,WAAW;YAC1C,CAAC;IACH,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,EAAE;IACX;AACF;AAEO,eAAe,YAAY,KAAa,EAAE,QAAQ,EAAE;IACzD,MAAM,qBAAqB,MAAM,uBAAuB,OAAO;IAE/D,IAAI,mBAAmB,MAAM,GAAG,GAAG;QACjC,OAAO;IACT;IAEA,OAAO,oBAAoB,OAAO;AACpC"}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///Users/chelseygowac/book-tracker-app/src/app/api/recommendations/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\nimport { supabase } from '@/lib/supabase/client';\nimport { searchBooks } from '@/lib/data-sources/book-sources';\n\nexport async function GET(request: NextRequest) {\n  const authHeader = request.headers.get('Authorization');\n  \n  try {\n    let userId: string | null = null;\n\n    if (authHeader?.startsWith('Bearer ')) {\n      const token = authHeader.substring(7);\n      const tempSupabase = createClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n        {\n          global: {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        }\n      );\n      \n      const { data: { user } } = await tempSupabase.auth.getUser();\n      userId = user?.id || null;\n    }\n\n    if (!userId) {\n      return NextResponse.json({ recommendations: [] });\n    }\n    \n    const { data: userBooksData, error } = await supabase\n      .from('user_books')\n      .select('*, books(*)')\n      .eq('user_id', userId);\n\n    if (error) {\n      throw new Error('Failed to fetch user books for recommendations');\n    }\n\n    const userBooks = userBooksData || [];\n    const userReadBooks = userBooks.filter((book: any) => book.status === 'READ');\n    \n    if (userReadBooks.length === 0) {\n      return NextResponse.json({ recommendations: [] });\n    }\n    \n    const allAuthors = userReadBooks.map((book: any) => book.books?.author || 'Unknown');\n    const authorCounts = allAuthors.reduce((acc: any, author: string) => {\n      acc[author] = (acc[author] || 0) + 1;\n      return acc;\n    }, {});\n    \n    const topAuthors = Object.entries(authorCounts)\n      .sort(([, a]: any, [, b]: any) => b - a)\n      .slice(0, 5)\n      .map(([author]) => author);\n    \n     const recommendedBooks: any[] = [];\n    \n    for (const author of topAuthors) {\n      try {\n        const books = await searchBooks(author, 3);\n        recommendedBooks.push(...books);\n      } catch (error) {\n        console.error(`Error fetching books for author ${author}:`, error);\n      }\n    }\n    \n     const genreResults = await Promise.all(userReadBooks\n        .filter((book: any) => book.books?.genres?.length > 0)\n        .map(async (book: any) => {\n          const primaryGenre = book.books?.genres?.[0];\n          if (!primaryGenre) return [];\n          \n          try {\n            const genreBooks = await searchBooks(primaryGenre, 3);\n           return genreBooks.filter((b: any) => \n             b.author !== book.books?.author && \n             b.isbn !== book.books?.isbn &&\n             !recommendedBooks.find((rb: any) => rb.isbn === b.isbn)\n           ).slice(0, 2);\n          } catch (error) {\n            console.error(`Error fetching books for genre ${primaryGenre}:`, error);\n            return [];\n          }\n         }));\n     const genreBasedRecommendations = genreResults.flatMap(x => x).slice(0, 5);\n    \n     const allRecommendations = [\n       ...recommendedBooks,\n       ...genreBasedRecommendations\n     ];\n     \n     const uniqueRecommendations = allRecommendations.filter((book, index, self) => \n       self.findIndex((b) => b.isbn === book.isbn) === index\n     );\n\n     const bookRecommendations = uniqueRecommendations.map((book: any) => ({\n       ...book,\n       type: 'personalized'\n     }));\n\n     return NextResponse.json({\n       recommendations: bookRecommendations.slice(0, 12),\n       count: bookRecommendations.length\n     });\n  } catch (error) {\n    console.error('Recommendations error:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch recommendations' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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"}}]
}