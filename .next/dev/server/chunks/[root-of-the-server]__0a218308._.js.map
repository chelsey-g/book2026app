{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/chelseygowac/book-tracker-app/src/app/api/users/books/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nexport async function GET(request: NextRequest) {\n  const authHeader = request.headers.get('Authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    return NextResponse.json(\n      { error: 'Unauthorized' },\n      { status: 401 }\n    );\n  }\n\n  const token = authHeader.substring(7);\n  const supabase = createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      global: {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      },\n    }\n  );\n  \n  try {\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n    \n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const { data, error } = await supabase\n      .from('user_books')\n      .select('*, books(*)')\n      .eq('user_id', user.id);\n\n    if (error) throw error;\n\n    return NextResponse.json({ books: data });\n  } catch (error) {\n    console.error('Failed to fetch user books:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch user books' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  const authHeader = request.headers.get('Authorization');\n  if (!authHeader?.startsWith('Bearer ')) {\n    return NextResponse.json(\n      { error: 'Unauthorized' },\n      { status: 401 }\n    );\n  }\n\n  const token = authHeader.substring(7);\n  const supabase = createClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      global: {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      },\n    }\n  );\n\n  try {\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n    \n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const body = await request.json();\n    const { bookId, status, currentPage, title, author, isbn, coverUrl, description, genres } = body;\n\n    if (!bookId || !status) {\n      return NextResponse.json(\n        { error: 'Book ID and status are required' },\n        { status: 400 }\n      );\n    }\n\n    const bookWithData = {\n      id: bookId,\n      title: title || 'Unknown',\n      author: author || 'Unknown',\n      isbn: isbn || null,\n      cover_url: coverUrl || null,\n      description: description || null,\n      genres: genres || [],\n    };\n\n    const { data: existingBook, error: checkError } = await supabase\n      .from('books')\n      .select('id')\n      .eq('id', bookId)\n      .single();\n\n    if (!existingBook) {\n      const { data: bookData, error: bookInsertError } = await supabase\n        .from('books')\n        .insert([bookWithData])\n        .select()\n        .single();\n\n      if (bookInsertError) {\n        console.error('Error inserting book:', bookInsertError);\n        throw new Error(`Failed to create book: ${bookInsertError.message}`);\n      }\n    }\n\n    const { data, error } = await supabase\n      .from('user_books')\n      .upsert(\n        {\n          user_id: user.id,\n          book_id: bookId,\n          status,\n          current_page: currentPage || null,\n          started_at: status === 'CURRENTLY_READING' ? new Date().toISOString() : null,\n          completed_at: status === 'READ' ? new Date().toISOString() : null,\n        },\n        { onConflict: 'user_id,book_id' }\n      )\n      .select('*, books(*)')\n      .single();\n\n    if (error) {\n      console.error('Supabase upsert error:', error);\n      throw error;\n    }\n\n    return NextResponse.json({ book: data });\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : JSON.stringify(error);\n    console.error('Failed to add book:', errorMessage);\n    return NextResponse.json(\n      { error: `Failed to add book: ${errorMessage}` },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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"}}]
}