(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4645,e=>{"use strict";let s=(0,e.i(10770).default)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);e.s(["Target",()=>s],4645)},63189,e=>{"use strict";var s=e.i(75219),t=e.i(20614),a=e.i(52655),r=e.i(41706),l=e.i(20299),o=e.i(8406),i=e.i(4645);function n(){let{user:e}=(0,a.useAuth)(),[n,c]=(0,t.useState)(null),[d,m]=(0,t.useState)([]),[x,g]=(0,t.useState)(null),[h,u]=(0,t.useState)(!0),[b,p]=(0,t.useState)(!1),[f,j]=(0,t.useState)(""),[N,y]=(0,t.useState)(!1),[v,w]=(0,t.useState)(12),[k,R]=(0,t.useState)(!1),[_,E]=(0,t.useState)(null),S=(0,t.useCallback)(async()=>{try{let{data:s,error:t}=await r.supabase.from("users").select("*").eq("id",e?.id).single();s&&!t?(console.log("Profile fetched:",s),console.log("Image URL:",s.image),c(s),j(s.bio||""),E(s.image||null)):console.error("User profile not found:",t)}catch(e){console.error("Error fetching profile:",e)}},[e?.id]);(0,t.useEffect)(()=>{e&&(S(),F(),C())},[e,S]);let F=async()=>{try{let{data:s,error:t}=await r.supabase.from("user_books").select("*, books(*)").eq("user_id",e?.id).order("updated_at",{ascending:!1});s&&!t&&m(s)}catch(e){console.error("Error fetching user books:",e)}finally{u(!1)}},C=async()=>{try{let{data:{session:e}}=await r.supabase.auth.getSession();if(!e?.access_token)return;let s=await fetch("/api/reading-goals",{headers:{Authorization:`Bearer ${e.access_token}`}}),t=await s.json();t.goal&&(g(t.goal),w(t.goal.goal_count))}catch(e){console.error("Error fetching reading goal:",e)}},A=async()=>{try{let{error:s}=await r.supabase.from("users").update({bio:f}).eq("id",e?.id);s?console.error("Error updating bio:",s):(c(e=>e?{...e,bio:f}:null),p(!1))}catch(e){console.error("Error updating bio:",e)}},P=async()=>{try{let{data:{session:e}}=await r.supabase.auth.getSession();if(!e?.access_token)return void console.error("No session token available");let s=await fetch("/api/reading-goals",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({goal_count:v,year:new Date().getFullYear()})}),t=await s.json();if(!s.ok){console.error("API Error:",t.error||"Unknown error"),alert("Error saving goal: "+(t.error||"Unknown error"));return}t.goal?(g(t.goal),y(!1),console.log("Goal saved successfully:",t.goal)):(console.error("No goal in response:",t),alert("Failed to save goal - no data returned"))}catch(e){console.error("Error updating reading goal:",e),alert("Error saving goal: "+String(e))}},U=e=>d.filter(s=>s.status===e),D=U("READ").filter(e=>!!e.completed_at&&new Date(e.completed_at).getFullYear()===new Date().getFullYear()).length,T=async e=>{console.log("File input changed, files:",e.target.files);let s=e.target.files?.[0];if(!s)return void console.log("No file selected");if(console.log("File selected:",s.name,s.type,s.size),!["image/jpeg","image/png","image/gif","image/webp"].includes(s.type))return void alert("Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed.");if(s.size>5242880)return void alert("File too large. Maximum size is 5MB.");R(!0),console.log("Starting upload...");try{let{data:{session:e}}=await r.supabase.auth.getSession();if(!e?.access_token)return void alert("Authentication required. Please sign in again.");let t=new FormData;t.append("profilePicture",s),console.log("FormData created with file:",s),console.log("FormData has profilePicture:",t.has("profilePicture")),console.log("Sending request to /api/profile-picture...");let a=await fetch("/api/profile-picture",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`},body:t});console.log("Response status:",a.status);let l=await a.json();if(console.log("Response data:",l),!a.ok)throw Error(l.error||"Upload failed");l.success&&(console.log("Upload successful, new URL:",l.profilePictureUrl),E(l.profilePictureUrl),c(e=>e?{...e,image:l.profilePictureUrl}:null),await S(),alert("Profile picture updated successfully!"))}catch(e){console.error("Upload error:",e),alert("Failed to upload profile picture: "+String(e))}finally{R(!1),e.target.value=""}};return e?h?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading profile..."})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-teal-50/30",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden mb-6",children:[(0,s.jsx)("div",{className:"h-24 bg-gradient-to-r from-teal-500 to-emerald-500"}),(0,s.jsxs)("div",{className:"px-8 pb-8",children:[(0,s.jsxs)("div",{className:"flex items-start gap-6 -mt-16 mb-6",children:[(0,s.jsxs)("div",{className:"relative",style:{width:"128px",height:"128px"},children:[_?(0,s.jsx)("img",{src:_,alt:"Profile",className:"h-32 w-32 object-cover rounded-full border-4 border-white shadow-lg"}):(0,s.jsx)("img",{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Ccircle cx='64' cy='64' r='64' fill='%23e5e7eb'/%3E%3C/svg%3E",alt:"Profile",className:"h-32 w-32 object-cover rounded-full border-4 border-white shadow-lg"}),(0,s.jsx)("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 bg-teal-600 hover:bg-teal-700 text-white rounded-full p-2 cursor-pointer shadow-lg transition-colors",title:"Upload avatar",children:k?(0,s.jsx)(o.FiUpload,{className:"w-5 h-5 animate-pulse"}):(0,s.jsx)(o.FiCamera,{className:"w-5 h-5"})}),(0,s.jsx)("input",{id:"avatar-upload",type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:T,className:"hidden",disabled:k})]}),(0,s.jsxs)("div",{className:"flex-1 mt-16",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-1",children:n?.name||e.user_metadata?.full_name||e.user_metadata?.name||e.email?.split("@")[0]||"User"}),(0,s.jsxs)("p",{className:"text-gray-500 mb-1",children:["@",e.user_metadata?.username||n?.username||e.email?.split("@")[0]||"user"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 flex items-center gap-1",children:[(0,s.jsx)(o.FiUsers,{className:"w-4 h-4"}),"Member since ",new Date(e.created_at||n?.created_at||"").toLocaleDateString("en-US",{month:"short",year:"numeric"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 border border-emerald-100",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(o.FiBook,{className:"w-5 h-5 text-emerald-600"})}),(0,s.jsx)("div",{className:"text-3xl font-bold text-emerald-700 mb-1",children:U("READ").length}),(0,s.jsx)("div",{className:"text-sm font-medium text-emerald-600",children:"Books Read"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(o.FiBook,{className:"w-5 h-5 text-blue-600"})}),(0,s.jsx)("div",{className:"text-3xl font-bold text-blue-700 mb-1",children:U("CURRENTLY_READING").length}),(0,s.jsx)("div",{className:"text-sm font-medium text-blue-600",children:"Currently Reading"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)(o.FiStar,{className:"w-5 h-5 text-amber-600"})}),(0,s.jsx)("div",{className:"text-3xl font-bold text-amber-700 mb-1",children:U("WANT_TO_READ").length}),(0,s.jsx)("div",{className:"text-sm font-medium text-amber-600",children:"Want to Read"})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"About"}),!b&&(0,s.jsx)("button",{onClick:()=>p(!0),className:"text-gray-400 hover:text-teal-600 transition-colors p-1 rounded hover:bg-white","aria-label":"Edit bio",children:(0,s.jsx)(o.FiEdit2,{className:"w-3.5 h-3.5"})})]}),b?(0,s.jsxs)("div",{children:[(0,s.jsx)("textarea",{value:f,onChange:e=>j(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent resize-none bg-white text-gray-900",rows:3,placeholder:"Tell us about yourself..."}),(0,s.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,s.jsx)("button",{onClick:A,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium",children:"Save"}),(0,s.jsx)("button",{onClick:()=>{p(!1),j(n?.bio||"")},className:"px-4 py-2 bg-white text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium border border-gray-200",children:"Cancel"})]})]}):(0,s.jsx)("p",{className:"text-gray-700 leading-relaxed text-sm",children:n?.bio||"No bio yet. Click the edit button to add one!"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(i.Target,{className:"w-6 h-6 text-teal-600 mr-2"}),(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[new Date().getFullYear()," Reading Goal"]})]}),!N&&(0,s.jsx)("button",{onClick:()=>y(!0),className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,s.jsx)(o.FiEdit2,{className:"w-4 h-4"})})]}),N?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Books Goal"}),(0,s.jsx)("input",{type:"number",min:"1",max:"365",value:v,onChange:e=>w(parseInt(e.target.value)||0),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-gray-900"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:P,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium",children:"Save Goal"}),(0,s.jsx)("button",{onClick:()=>{y(!1),x&&w(x.goal_count)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium",children:"Cancel"})]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-teal-600",children:v}),(0,s.jsx)("div",{className:"text-sm text-teal-700 mt-1",children:"Books Goal"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:D}),(0,s.jsx)("div",{className:"text-sm text-blue-700 mt-1",children:"Read This Year"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"text-3xl font-bold text-purple-600",children:[Math.round(D/v*100),"%"]}),(0,s.jsx)("div",{className:"text-sm text-purple-700 mt-1",children:"Progress"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,s.jsx)(o.FiBook,{className:"w-5 h-5 mr-2 text-teal-600"}),"Currently Reading"]}),(0,s.jsxs)("div",{className:"space-y-3",children:[U("CURRENTLY_READING").map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("img",{src:e.books?.cover_url||"/placeholder-book.png",alt:e.books?.title,className:"w-12 h-16 object-cover rounded"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.books?.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.books?.author})]})]},e.id)),0===U("CURRENTLY_READING").length&&(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-teal-50 rounded-full mb-3",children:(0,s.jsx)(o.FiBook,{className:"w-6 h-6 text-teal-600"})}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mb-3",children:"No books in progress"}),(0,s.jsx)(l.default,{href:"/search",className:"inline-block px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Start Reading"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,s.jsx)(o.FiStar,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Want to Read"]}),(0,s.jsxs)("div",{className:"space-y-3",children:[U("WANT_TO_READ").slice(0,5).map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("img",{src:e.books?.cover_url||"/placeholder-book.png",alt:e.books?.title,className:"w-12 h-16 object-cover rounded"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.books?.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.books?.author})]})]},e.id)),0===U("WANT_TO_READ").length&&(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-yellow-50 rounded-full mb-3",children:(0,s.jsx)(o.FiStar,{className:"w-6 h-6 text-yellow-600"})}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mb-3",children:"No books on your wishlist"}),(0,s.jsx)(l.default,{href:"/search",className:"inline-block px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 transition-colors",children:"Discover Books"})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,s.jsx)(o.FiBook,{className:"w-5 h-5 mr-2 text-green-600"}),"Recently Read"]}),(0,s.jsxs)("div",{className:"space-y-3",children:[U("READ").slice(0,5).map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("img",{src:e.books?.cover_url||"/placeholder-book.png",alt:e.books?.title,className:"w-12 h-16 object-cover rounded"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.books?.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.books?.author})]})]},e.id)),0===U("READ").length&&(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No books read yet"})]})]})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in to view your profile"}),(0,s.jsx)(l.default,{href:"/auth/signin",className:"text-blue-600 hover:text-blue-800",children:"Sign In"})]})})}e.s(["default",()=>n])}]);