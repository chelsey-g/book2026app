(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2817,e=>{"use strict";let t=(0,e.i(10770).default)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);e.s(["Loader",()=>t],2817)},9463,e=>{"use strict";let t=(0,e.i(10770).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],9463)},99436,e=>{"use strict";let t=(0,e.i(10770).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],99436)},40649,e=>{"use strict";var t=e.i(75219),s=e.i(20614),r=e.i(52655),a=e.i(20299),l=e.i(9463);let i=(0,e.i(10770).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var o=e.i(99436),n=e.i(2817),d=e.i(44868);function c(){let{user:c}=(0,r.useAuth)(),[h,m]=(0,s.useState)(null),[x,u]=(0,s.useState)([]),[g,p]=(0,s.useState)(!1),[b,y]=(0,s.useState)(!1),[f,j]=(0,s.useState)(!1),[N,v]=(0,s.useState)(new Date().getFullYear());if(!c)return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-teal-50/30 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.BookOpen,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Sign In Required"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Sign in to import books from your Notion database"}),(0,t.jsx)(a.default,{href:"/auth/signin",className:"px-6 py-3 bg-[#018283] text-white rounded-lg hover:bg-[#017374]",children:"Sign In"})]})});let w=async e=>{let t=e.target.files?.[0];if(t){m(t),p(!0);try{let e=await t.text(),s=S(e).map((e,t)=>({...e,id:`book-${t}`,selected:!0,searchStatus:"pending"}));u(s),await C(s)}catch(e){console.error("Error parsing CSV:",e),alert("Error parsing CSV file. Please ensure it's exported from Notion.")}finally{p(!1)}}},k=e=>{let t=[],s="",r=!1;for(let a=0;a<e.length;a++){let l=e[a];'"'===l?r=!r:","!==l||r?s+=l:(t.push(s),s="")}return t.push(s),t},S=e=>{let t=e.split("\n"),s=k(t[0]).map(e=>e.trim().toLowerCase()),r=[];for(let e=1;e<t.length;e++){if(!t[e].trim())continue;let a=k(t[e]).map(e=>e.trim()),l={name:"",author:"",status:"READ",rating:0};s.forEach((e,t)=>{let s=a[t];if(e.includes("name")||e.includes("title"))l.name=s;else if(e.includes("author"))l.author=s;else if(e.includes("status"))l.status=({finished:"READ","currently reading":"CURRENTLY_READING","want to read":"WANT_TO_READ","did not finish":"DNF"})[s.toLowerCase()]||"READ";else if(e.includes("score")||e.includes("rating")){let e=(s.match(/â­/g)||[]).length;l.rating=e>0?e:0}else e.includes("date sta")?l.dateStarted=s:e.includes("date fin")?l.dateFinished=s:e.includes("type")&&(l.type=s)}),l.name&&l.author&&r.push(l)}return r},C=async e=>{j(!0);let t=[...e];for(let e=0;e<t.length;e++){try{let s=await fetch(`/api/books/search?q=${encodeURIComponent(t[e].name)} ${encodeURIComponent(t[e].author)}&limit=1`),r=await s.json();if(r.books&&r.books.length>0){let s=r.books[0];t[e].coverUrl=s.cover_url||s.coverUrl,t[e].description=s.description,t[e].searchStatus="found"}else t[e].searchStatus="not-found"}catch(s){console.error(`Error searching for ${t[e].name}:`,s),t[e].searchStatus="not-found"}u([...t])}j(!1)},R=e=>{u(x.map(t=>({...t,selected:e})))},A=async()=>{let t=x.filter(e=>e.selected);if(0===t.length)return void alert("Please select at least one book to import");y(!0);try{let{supabase:s}=await e.A(38564),{data:{session:r}}=await s.auth.getSession();if(!r?.access_token)throw Error("Authentication required");let a=t.map(e=>({name:e.name,author:e.author,status:e.status,rating:e.rating,dateStarted:e.dateStarted,dateFinished:e.dateFinished,type:e.type,cover:e.coverUrl,year:N}));console.log("ðŸ“¤ Sending books to import:",a),console.log("ðŸ“¤ Auth token:",r.access_token?.slice(0,20)+"...");let l=await fetch("/api/books/bulk-import",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify(a)}),i=await l.json();if(console.log("ðŸ“¥ Response:",{status:l.status,data:i}),!l.ok)throw Error(i.error||`API Error: ${l.status}`);let o=i.errors?.length>0?`

Failed: ${i.errors.map(e=>`${e.book}: ${e.error}`).join("\n")}`:"";alert(`Successfully imported ${i.importedCount} books!${o}`),u([]),m(null)}catch(e){console.error("âŒ Import error:",e),alert(`Import failed: ${e instanceof Error?e.message:"Unknown error"}`)}finally{y(!1)}},E=x.filter(e=>e.selected).length,U=x.filter(e=>"found"===e.searchStatus).length;return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-teal-50/30",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Import Books from Notion"}),(0,t.jsx)("p",{className:"text-lg text-gray-600",children:"Upload your Notion CSV export to quickly add books to your library"})]}),0===x.length?(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-50 rounded-full mb-4",children:(0,t.jsx)(l.Upload,{className:"w-8 h-8 text-blue-600"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Upload Notion CSV"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Export your reading list from Notion as CSV and upload it here. We'll match each book with cover art and let you review before importing."}),(0,t.jsxs)("label",{className:"inline-block",children:[(0,t.jsx)("input",{type:"file",accept:".csv",onChange:w,className:"hidden",disabled:g}),(0,t.jsx)("span",{className:"inline-flex items-center gap-2 px-6 py-3 bg-[#018283] text-white rounded-lg hover:bg-[#017374] cursor-pointer transition-colors font-medium",children:g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Loader,{className:"w-5 h-5 animate-spin"}),"Processing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Upload,{className:"w-5 h-5"}),"Choose CSV File"]})})]}),(0,t.jsxs)("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[(0,t.jsx)("p",{className:"text-sm text-blue-900 font-medium mb-3",children:"ðŸ“‹ How to export from Notion:"}),(0,t.jsxs)("ol",{className:"text-sm text-blue-800 space-y-2 text-left max-w-md mx-auto",children:[(0,t.jsx)("li",{children:"1. Open your Notion database"}),(0,t.jsx)("li",{children:"2. Click the â‹¯ menu (top right)"}),(0,t.jsx)("li",{children:'3. Select "Download" â†’ "Markdown & CSV"'}),(0,t.jsx)("li",{children:"4. Upload the CSV file here"})]})]})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:[x.length," books found"]}),(0,t.jsxs)("p",{className:"text-gray-600",children:[U," with cover art â€¢ ",E," selected"]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>R(!0),className:"px-4 py-2 text-sm font-medium text-[#018283] border border-[#018283] rounded-lg hover:bg-[#018283]/5",children:"Select All"}),(0,t.jsx)("button",{onClick:()=>R(!1),className:"px-4 py-2 text-sm font-medium text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Deselect All"})]})]}),(0,t.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Reading Year"}),(0,t.jsx)("select",{value:N,onChange:e=>v(parseInt(e.target.value)),className:"w-full sm:w-48 px-4 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-[#018283] focus:border-transparent bg-white",children:Array.from({length:10},(e,s)=>{let r=new Date().getFullYear()-s;return(0,t.jsx)("option",{value:r,children:r},r)})}),(0,t.jsx)("p",{className:"text-xs text-blue-700 mt-2",children:"Select the year when you read these books. Dates without years will use this year."})]}),f&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center gap-2 text-blue-900",children:[(0,t.jsx)(n.Loader,{className:"w-4 h-4 animate-spin"}),"Searching for cover art..."]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(e=>(0,t.jsx)("div",{onClick:()=>{var t;return t=e.id,void u(x.map(e=>e.id===t?{...e,selected:!e.selected}:e))},className:`rounded-lg border-2 p-4 cursor-pointer transition-all ${e.selected?"border-[#018283] bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-16",children:e.coverUrl?(0,t.jsx)("img",{src:e.coverUrl,alt:e.name,className:"w-16 h-24 object-cover rounded"}):(0,t.jsx)("div",{className:"w-16 h-24 bg-gray-200 rounded flex items-center justify-center",children:(0,t.jsx)(d.BookOpen,{className:"w-6 h-6 text-gray-400"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 truncate text-sm",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:e.author})]}),(0,t.jsx)("div",{className:"flex-shrink-0",children:"found"===e.searchStatus?(0,t.jsx)(i,{className:"w-5 h-5 text-green-500"}):"not-found"===e.searchStatus?(0,t.jsx)(o.XCircle,{className:"w-5 h-5 text-gray-300"}):(0,t.jsx)(n.Loader,{className:"w-5 h-5 animate-spin text-gray-400"})})]}),(0,t.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,t.jsxs)("div",{className:"flex gap-2 text-xs",children:[(0,t.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded",children:"READ"===e.status?"Read":"CURRENTLY_READING"===e.status?"Reading":"WANT_TO_READ"===e.status?"Want to Read":"DNF"}),e.rating>0&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-yellow-100 rounded flex items-center gap-1",children:["â­ ",e.rating]})]}),e.dateFinished&&(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Finished: ",e.dateFinished]})]})]})]})},e.id))}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>{u([]),m(null)},className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:"Cancel"}),(0,t.jsx)("button",{onClick:A,disabled:b||0===E,className:"flex-1 px-6 py-3 bg-[#018283] text-white rounded-lg hover:bg-[#017374] disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Loader,{className:"w-5 h-5 animate-spin inline mr-2"}),"Importing..."]}):`Import ${E} Books`})]})]})]})})}e.s(["default",()=>c],40649)},38564,e=>{e.v(e=>Promise.resolve().then(()=>e(41706)))}]);