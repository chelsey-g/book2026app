module.exports=[11550,a=>{"use strict";var b=a.i(86531),c=a.i(52715),d=a.i(14366),e=a.i(1791),f=a.i(75662),g=a.i(96039),h=a.i(49602);function i(){let{user:a}=(0,d.useAuth)(),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(12),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),C=(0,c.useCallback)(async()=>{try{let{data:b,error:c}=await e.supabase.from("users").select("*").eq("id",a?.id).single();b&&!c?(console.log("Profile fetched:",b),console.log("Image URL:",b.image),j(b),t(b.bio||""),B(b.image||null)):console.error("User profile not found:",c)}catch(a){console.error("Error fetching profile:",a)}},[a?.id]);(0,c.useEffect)(()=>{a&&(C(),D(),E())},[a,C]);let D=async()=>{try{let{data:b,error:c}=await e.supabase.from("user_books").select("*, books(*)").eq("user_id",a?.id).order("updated_at",{ascending:!1});b&&!c&&l(b)}catch(a){console.error("Error fetching user books:",a)}finally{p(!1)}},E=async()=>{try{let{data:{session:a}}=await e.supabase.auth.getSession();if(!a?.access_token)return;let b=await fetch("/api/reading-goals",{headers:{Authorization:`Bearer ${a.access_token}`}}),c=await b.json();c.goal&&(n(c.goal),x(c.goal.goal_count))}catch(a){console.error("Error fetching reading goal:",a)}},F=async()=>{try{let{error:b}=await e.supabase.from("users").update({bio:s}).eq("id",a?.id);b?console.error("Error updating bio:",b):(j(a=>a?{...a,bio:s}:null),r(!1))}catch(a){console.error("Error updating bio:",a)}},G=async()=>{try{let{data:{session:a}}=await e.supabase.auth.getSession();if(!a?.access_token)return void console.error("No session token available");let b=await fetch("/api/reading-goals",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({goal_count:w,year:new Date().getFullYear()})}),c=await b.json();if(!b.ok){console.error("API Error:",c.error||"Unknown error"),alert("Error saving goal: "+(c.error||"Unknown error"));return}c.goal?(n(c.goal),v(!1),console.log("Goal saved successfully:",c.goal)):(console.error("No goal in response:",c),alert("Failed to save goal - no data returned"))}catch(a){console.error("Error updating reading goal:",a),alert("Error saving goal: "+String(a))}},H=a=>k.filter(b=>b.status===a),I=H("READ").filter(a=>!!a.completed_at&&new Date(a.completed_at).getFullYear()===new Date().getFullYear()).length,J=async a=>{console.log("File input changed, files:",a.target.files);let b=a.target.files?.[0];if(!b)return void console.log("No file selected");if(console.log("File selected:",b.name,b.type,b.size),!["image/jpeg","image/png","image/gif","image/webp"].includes(b.type))return void alert("Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed.");if(b.size>5242880)return void alert("File too large. Maximum size is 5MB.");z(!0),console.log("Starting upload...");try{let{data:{session:a}}=await e.supabase.auth.getSession();if(!a?.access_token)return void alert("Authentication required. Please sign in again.");let c=new FormData;c.append("profilePicture",b),console.log("FormData created with file:",b),console.log("FormData has profilePicture:",c.has("profilePicture")),console.log("Sending request to /api/profile-picture...");let d=await fetch("/api/profile-picture",{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`},body:c});console.log("Response status:",d.status);let f=await d.json();if(console.log("Response data:",f),!d.ok)throw Error(f.error||"Upload failed");f.success&&(console.log("Upload successful, new URL:",f.profilePictureUrl),B(f.profilePictureUrl),j(a=>a?{...a,image:f.profilePictureUrl}:null),await C(),alert("Profile picture updated successfully!"))}catch(a){console.error("Upload error:",a),alert("Failed to upload profile picture: "+String(a))}finally{z(!1),a.target.value=""}};return a?o?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-lg",children:"Loading profile..."})}):(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-teal-50/30",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden mb-6",children:[(0,b.jsx)("div",{className:"h-24 bg-gradient-to-r from-teal-500 to-emerald-500"}),(0,b.jsxs)("div",{className:"px-8 pb-8",children:[(0,b.jsxs)("div",{className:"flex items-start gap-6 -mt-16 mb-6",children:[(0,b.jsxs)("div",{className:"relative",style:{width:"128px",height:"128px"},children:[A?(0,b.jsx)("img",{src:A,alt:"Profile",className:"h-32 w-32 object-cover rounded-full border-4 border-white shadow-lg"}):(0,b.jsx)("img",{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Ccircle cx='64' cy='64' r='64' fill='%23e5e7eb'/%3E%3C/svg%3E",alt:"Profile",className:"h-32 w-32 object-cover rounded-full border-4 border-white shadow-lg"}),(0,b.jsx)("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 bg-teal-600 hover:bg-teal-700 text-white rounded-full p-2 cursor-pointer shadow-lg transition-colors",title:"Upload avatar",children:y?(0,b.jsx)(g.FiUpload,{className:"w-5 h-5 animate-pulse"}):(0,b.jsx)(g.FiCamera,{className:"w-5 h-5"})}),(0,b.jsx)("input",{id:"avatar-upload",type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:J,className:"hidden",disabled:y})]}),(0,b.jsxs)("div",{className:"flex-1 mt-16",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-1",children:i?.name||a.user_metadata?.full_name||a.user_metadata?.name||a.email?.split("@")[0]||"User"}),(0,b.jsxs)("p",{className:"text-gray-500 mb-1",children:["@",a.user_metadata?.username||i?.username||a.email?.split("@")[0]||"user"]}),(0,b.jsxs)("p",{className:"text-sm text-gray-400 flex items-center gap-1",children:[(0,b.jsx)(g.FiUsers,{className:"w-4 h-4"}),"Member since ",new Date(a.created_at||i?.created_at||"").toLocaleDateString("en-US",{month:"short",year:"numeric"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 rounded-xl p-4 border border-emerald-100",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsx)(g.FiBook,{className:"w-5 h-5 text-emerald-600"})}),(0,b.jsx)("div",{className:"text-3xl font-bold text-emerald-700 mb-1",children:H("READ").length}),(0,b.jsx)("div",{className:"text-sm font-medium text-emerald-600",children:"Books Read"})]}),(0,b.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsx)(g.FiBook,{className:"w-5 h-5 text-blue-600"})}),(0,b.jsx)("div",{className:"text-3xl font-bold text-blue-700 mb-1",children:H("CURRENTLY_READING").length}),(0,b.jsx)("div",{className:"text-sm font-medium text-blue-600",children:"Currently Reading"})]}),(0,b.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 border border-amber-100",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsx)(g.FiStar,{className:"w-5 h-5 text-amber-600"})}),(0,b.jsx)("div",{className:"text-3xl font-bold text-amber-700 mb-1",children:H("WANT_TO_READ").length}),(0,b.jsx)("div",{className:"text-sm font-medium text-amber-600",children:"Want to Read"})]})]}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"About"}),!q&&(0,b.jsx)("button",{onClick:()=>r(!0),className:"text-gray-400 hover:text-teal-600 transition-colors p-1 rounded hover:bg-white","aria-label":"Edit bio",children:(0,b.jsx)(g.FiEdit2,{className:"w-3.5 h-3.5"})})]}),q?(0,b.jsxs)("div",{children:[(0,b.jsx)("textarea",{value:s,onChange:a=>t(a.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent resize-none bg-white text-gray-900",rows:3,placeholder:"Tell us about yourself..."}),(0,b.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,b.jsx)("button",{onClick:F,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium",children:"Save"}),(0,b.jsx)("button",{onClick:()=>{r(!1),t(i?.bio||"")},className:"px-4 py-2 bg-white text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium border border-gray-200",children:"Cancel"})]})]}):(0,b.jsx)("p",{className:"text-gray-700 leading-relaxed text-sm",children:i?.bio||"No bio yet. Click the edit button to add one!"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(h.Target,{className:"w-6 h-6 text-teal-600 mr-2"}),(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:[new Date().getFullYear()," Reading Goal"]})]}),!u&&(0,b.jsx)("button",{onClick:()=>v(!0),className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,b.jsx)(g.FiEdit2,{className:"w-4 h-4"})})]}),u?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Books Goal"}),(0,b.jsx)("input",{type:"number",min:"1",max:"365",value:w,onChange:a=>x(parseInt(a.target.value)||0),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-gray-900"})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("button",{onClick:G,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors text-sm font-medium",children:"Save Goal"}),(0,b.jsx)("button",{onClick:()=>{v(!1),m&&x(m.goal_count)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium",children:"Cancel"})]})]}):(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-teal-600",children:w}),(0,b.jsx)("div",{className:"text-sm text-teal-700 mt-1",children:"Books Goal"})]}),(0,b.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:I}),(0,b.jsx)("div",{className:"text-sm text-blue-700 mt-1",children:"Read This Year"})]}),(0,b.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-purple-600",children:[Math.round(I/w*100),"%"]}),(0,b.jsx)("div",{className:"text-sm text-purple-700 mt-1",children:"Progress"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(g.FiBook,{className:"w-5 h-5 mr-2 text-teal-600"}),"Currently Reading"]}),(0,b.jsxs)("div",{className:"space-y-3",children:[H("CURRENTLY_READING").map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("img",{src:a.books?.cover_url||"/placeholder-book.png",alt:a.books?.title,className:"w-12 h-16 object-cover rounded"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.books?.title}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.books?.author})]})]},a.id)),0===H("CURRENTLY_READING").length&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-teal-50 rounded-full mb-3",children:(0,b.jsx)(g.FiBook,{className:"w-6 h-6 text-teal-600"})}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-3",children:"No books in progress"}),(0,b.jsx)(f.default,{href:"/search",className:"inline-block px-4 py-2 bg-teal-600 text-white text-sm font-medium rounded-lg hover:bg-teal-700 transition-colors",children:"Start Reading"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(g.FiStar,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Want to Read"]}),(0,b.jsxs)("div",{className:"space-y-3",children:[H("WANT_TO_READ").slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("img",{src:a.books?.cover_url||"/placeholder-book.png",alt:a.books?.title,className:"w-12 h-16 object-cover rounded"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.books?.title}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.books?.author})]})]},a.id)),0===H("WANT_TO_READ").length&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-yellow-50 rounded-full mb-3",children:(0,b.jsx)(g.FiStar,{className:"w-6 h-6 text-yellow-600"})}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-3",children:"No books on your wishlist"}),(0,b.jsx)(f.default,{href:"/search",className:"inline-block px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 transition-colors",children:"Discover Books"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(g.FiBook,{className:"w-5 h-5 mr-2 text-green-600"}),"Recently Read"]}),(0,b.jsxs)("div",{className:"space-y-3",children:[H("READ").slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("img",{src:a.books?.cover_url||"/placeholder-book.png",alt:a.books?.title,className:"w-12 h-16 object-cover rounded"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.books?.title}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.books?.author})]})]},a.id)),0===H("READ").length&&(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"No books read yet"})]})]})]})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in to view your profile"}),(0,b.jsx)(f.default,{href:"/auth/signin",className:"text-blue-600 hover:text-blue-800",children:"Sign In"})]})})}a.s(["default",()=>i])}];

//# sourceMappingURL=book-tracker-app_src_app_profile_page_tsx_a49c5585._.js.map